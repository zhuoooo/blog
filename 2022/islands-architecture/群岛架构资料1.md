# Islands Architecture

[原文](https://jasonformat.com/islands-architecture/)

我很难在网上找到这方面的参考资料，但今年在描述这里概述的方法时，听到这个名字被多次使用。据我所知，“组件岛”模式是由 Etsy 的前端架构师 Katie Sylor-Miller 在2019年的一次会议上提出的。

“岛屿” 架构的总体思路看似简单：在服务器上渲染`HTML`页面，并在高度动态的区域周围注入占位符或插槽。这些占位符/槽包含服务器渲染的`HTML`输出，来自其相应的小部件。它们表示的区域可以在客户端 "水化 "为小型的独立部件，重新使用其服务器渲染的初始`HTML`。

你可以认为这就像一个静态的`HTML`文档，其中包含多个独立的嵌入式应用程序：



![](./img/islands-architecture-1.png)

乍看之下，这似乎与“微前端”相似。这两种方法都有一个共同的想法，就是将应用程序分解成独立的单元，然而 
“微前端”通常并不意味着这些单元的组成是通过HTML实现的。

与 “岛屿” 方法更接近的是渐进式增强，我们基本上是在为其添加`SSR`水化和为页面的某个区域添加互动性的一致的隐喻。在传统的渐进式增强中，我们可能会有一个`<script>`来寻找页面中的图片旋转木马，并在其上实例化一个`jQuery`插件。相反，图像旋转木马将在服务器上被渲染，并为它发出一个专门的`<script>`，加载图像旋转木马的实现，并在原地将其升级为交互式。

## 为什么这很重要？

事实证明，与典型的单页应用程序架构相比，这里描述的一组方法有许多好处。

### "渐进式水合 "的免费性

我已经吹捧了React、Angular、Preact和Vue等框架的渐进式水合技术的性能优势。在这些架构中，页面上的各个小部件会随着时间的推移被加载和初始化。这可以通过requestIdleCallback使用简单的调度方法来完成，也可以考虑其他因素，如视口可见性、交互可能性、产品价值等。

与渐进式水合类似，使用岛屿架构渲染页面的结果是，页面中较重的动态部分不仅被逐步初始化，而且被单独初始化。这意味着页面的个别区域会变得互动，而不需要先加载页面上的其他东西。

与渐进式水合不同，围绕岛屿架构的方法不需要自上而下的渲染。这是一个明显的优势，因为没有外部的 "根 "组件必须在其后代之前被初始化。页面的每一部分都是一个孤立的单元，一个单元的性能问题不会影响其他单元。

### 搜索引擎优化和用户体验并不是一种权衡

单页面应用程序所使用的SSR的现状是，它经常被认为是出于SEO的需要。然而，SSR实际上会对用户体验产生负面的影响--访问者在等待页面的实际功能时，只能盯着该页面的一个令人沮丧的假版本。

许多应用程序也在不知不觉中受到SSR性能隐患的影响。在虚拟DOM库中，很容易（也很常见）意外地构建一种情况，即第一次渲染会破坏服务器渲染的HTML DOM，然后再从头开始重新创建它（通常是同步的）。这是一些常见的误解造成的，这些误解可能源于文档中对水合的理想化看法，而忽略了棘手的注意事项和脚步声。

即使是在SSR水合功能按设计运行的情况下，现状也有很多需要改进的地方。在页面加载过程中执行的JavaScript工作量仍然比可能被认为是 "有效 "的要多出许多数量级。

### 更利于可访问性和可发现性

一个使用标准HTML链接进行导航的网站，对于辅助技术和网络爬虫来说，更容易使用。无论链接或表单是否被JavaScript拦截并转到客户端逻辑，这一点都是真实的，因为基本的假设仍然是真实的：点击一个链接就可以导航到指定的页面。

举个例子，想想有多少次你被发送一个 "链接 "到发送者认为是他们正在浏览的页面，但却发现这个链接没有包含任何必要的信息。

构建基于页面的应用程序并不能完全避免这些类型的奇怪体验，它只是使这样做的决定更加直接。它使默认的结果成为可访问的结果。

归根结底，提供一个需要更少代码来做某事的架构，是你未来的自己（或同事）会感谢你的长期利益的类型。有可能--甚至有可能--采用这样的模式需要更多的前期设计思维。在将应用程序分解为可独立交付的小部件方面，可用的含电池的选项很少。谁知道呢，也许我们可以解决这个问题。