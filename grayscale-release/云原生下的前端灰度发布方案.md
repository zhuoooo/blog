# 云原生下的前端灰度发布方案



## 背景

为什么做灰度发布，其实很好理解：在不影响用户正常使用工作的前提下，引入小部分的用户来使用新版本，帮助我们测试用户对于新版本的接受程度；避免决策失误所产生的问题影响到大部分甚至全量用户，保证了产品平滑过度。

灰度发布的优点：

1. 提前收集用户使用意见，及时完善产品功能
2. 控制未知异常只出现在小范围内，不影响大多数用户
3. 发现产品是否存在外在问题（如合规），可及时回滚至已旧版本

## 需求分析

- 能够对租户进行精细化操作：

  - 能够对有问题租户进行下线处置；
  
  
    - 标记租户，将租户流量切分成标准版本以及抢先体验版，未来可以分割成多个版本；
  


- 能够对微服务进行精细化控制：

  - 熔断处理；
  
  
    - 服务降级处理；
  
  
    - 能够对微服务进行性能监控；
  
- 灰度用户策略



## 方案选择



### 硬编码



### Ngxin分流



### Nginx + Lua + Redis



### 服务端渲染分流



## 实践



## 架构



## 参考文章

- [前端灰度发布落地方案](https://juejin.cn/post/7010751591087079460)